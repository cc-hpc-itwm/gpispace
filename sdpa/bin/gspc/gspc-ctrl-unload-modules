#!/bin/bash

GSPC_API_COMMAND_SHORT_DESCRIPTION="unload all modules on the given processes"
GSPC_API_COMMAND_LEVEL=2

. $(gspc --exec-path)/gspc-sh-setup

function usage()
{
    cat <<EOF
usage: unload-modules [-h|--help] [options]
EOF
}

urls=()
while true ; do
    case "$1" in
        -h|--help) usage ; exit ${GSPC_EX_OK} ;;
        --url)
            urls+=("$2")
            shift; shift
            ;;
        --) shift; break ;;
        *) break ;;
    esac
done

if [ ${#urls[@]} -eq 0 ]
then
    usage
    exit ${GSPC_EX_USAGE}
fi

for u in ${urls[@]}
do
    gspcnet-req -d /service/wfe/unload-modules \
                -b ""                          \
                --no-headers                   \
                "${u}"
done
