#!/bin/bash

function usage ()
{
    cat >&2 <<EOF
usage: $0 [options]

    -h: print this help
    -r root: sdpa root directory
EOF
}

log_port=
gui_port=
sdpa_root=$(cd $(dirname "$0")/../../../ && pwd)

while getopts ":hG:L:s:r:" opt; do
    case $opt in
        h)
            usage
            exit 0
            ;;
        G)
            gui_port=$OPTARG
            ;;
        L)
            log_port=$OPTARG
            ;;
        r)
            sdpa_root="$OPTARG"
            ;;
        \?)
            echo "invalid option: -$OPTARG" >&2
            echo "try: $0 -h" >&2
            exit 1
            ;;
    esac
done

bin="${sdpa_root}/bin/sdpa-gui"

if [ ! -x "${bin}" ] ; then
    echo >&2 "$bin is not executable"
    exit 3
fi

echo >&2 "Running ${bin} $gui_port $log_port on $(hostname -s)"

err=$($bin $gui_port $log_port 2>&1)
ec=$?
if [ $ec -ne 0 ] ; then
        echo >&2 "sdpa-gui failed: $ec: $err"
        exit $ec
fi
