#!/bin/bash

function prepend_path ()
{
    local var="$1"; shift
    local val=$(eval echo \$${var})
    for v ; do
	val=$(echo "$val" | sed "s,:$v:,:,g")
	val=$(echo "$val" | sed -e "s,^$v:,,g")
	val=$(echo "$val" | sed -e "s,:$v\$,,g")
	val="$v:$val"
    done
    eval "$var=$val"
}

if [ -z "$SDPA_HOME" ] ; then
    if [ -z "${BASH_SOURCE[0]}" ] ; then
        echo >&2 "SDPA_HOME is not set, please set it to the installation"
        return 1
    fi
    mypath=$(dirname "${BASH_SOURCE[0]}")
    case "$mypath" in
        /*) mypath="$mypath" ;;
        *)  mypath="$PWD/$mypath" ;;
    esac
    SDPA_HOME=$(cd "${mypath}/../.." && pwd)
    unset mypath
fi

prefix="$SDPA_HOME"

if [ -z "$prefix" -o ! -d "$prefix" ] ; then
    echo "cannot access '$prefix': no such directory" >&2
    return 1
else
    if [ -z "$SDPA_LOADED" -o -n "$FORCE_LOAD_SDPA" ]; then
	if [ -n "$FORCE_LOAD_SDPA" ]
	then
	    echo "forcing load of sdpa.env" >&2
	fi

	export SDPA_HOME="$prefix"
	export SDPA_LIBEXEC="$prefix/libexec/sdpa"
	export SDPA_PLUGINS="$prefix/libexec/fhg/plugins"

	prepend_path PATH "${SDPA_HOME}/bin"
	prepend_path LD_LIBRARY_PATH "${prefix}/lib:${SDPA_LIBEXEC}"

	export PATH LD_LIBRARY_PATH

	export SDPA_LOADED=true
    fi
fi

unset prefix
unset default_prefix
unset version
