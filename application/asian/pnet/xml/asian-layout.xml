<defun name="asian" internal="true">
  <struct name="sums">
    <field name="param" type="param"/>
    <field name="sum1" type="double"/>
    <field name="sum2" type="double"/>
  </struct>
  <struct name="pair_of_sums">
    <field name="one" type="sums"/>
    <field name="two" type="sums"/>
  </struct>
  <in name="param" type="param" place="param">
    <properties name="fhg">
      <properties name="pnete">
        <properties name="position">
          <property key="y">
            300
          </property>
          <property key="x">
            40
          </property>
        </properties>
      </properties>
    </properties>
  </in>
  <out name="result" type="result" place="result">
    <properties name="fhg">
      <properties name="pnete">
        <properties name="position">
          <property key="y">
            280
          </property>
          <property key="x">
            3710
          </property>
        </properties>
      </properties>
    </properties>
  </out>
  <net>
    <place name="param" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              300
            </property>
            <property key="x">
              190
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="param_eps1" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              150
            </property>
            <property key="x">
              650
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="param_eps2" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              60
            </property>
            <property key="x">
              1160
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="param_delta" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              -110
            </property>
            <property key="x">
              1680
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="id" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              380
            </property>
            <property key="x">
              670
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="eps1" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              280
            </property>
            <property key="x">
              1170
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="eps2" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              140
            </property>
            <property key="x">
              1660
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="delta" type="param">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              -80
            </property>
            <property key="x">
              2280
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="sums_id" type="sums">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              470
            </property>
            <property key="x">
              2650
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="sums_eps1" type="sums">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              330
            </property>
            <property key="x">
              2160
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="sums_eps2" type="sums">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              180
            </property>
            <property key="x">
              2460
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="sums_delta" type="sums">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              60
            </property>
            <property key="x">
              2830
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="pre_result" type="result">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              280
            </property>
            <property key="x">
              3120
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <place name="result" type="result">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              280
            </property>
            <property key="x">
              3570
            </property>
          </properties>
        </properties>
      </properties>
    </place>
    <transition name="id">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              300
            </property>
            <property key="x">
              420
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <in name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -50
                </property>
                <property key="x">
                  70
                </property>
              </properties>
              <property key="orientation">
                NORTH
              </property>
            </properties>
          </properties>
        </out>
        <out name="div" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  50
                </property>
                <property key="x">
                  70
                </property>
              </properties>
              <property key="orientation">
                SOUTH
              </property>
            </properties>
          </properties>
        </out>
        <expression>
          ${div} := ${param}
        </expression>
      </defun>
      <connect-in port="param" place="param"/>
      <connect-out port="param" place="param_eps1"/>
      <connect-out port="div" place="id"/>
    </transition>
    <transition name="eps1">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              120
            </property>
            <property key="x">
              940
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <in name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -10
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <out name="div" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  50
                </property>
                <property key="x">
                  50
                </property>
              </properties>
              <property key="orientation">
                SOUTH
              </property>
            </properties>
          </properties>
        </out>
        <expression>
          ${div} := ${param}; ${div.S} := ${div.S} * (1.0 + ${div.epsilon})
        </expression>
      </defun>
      <connect-in port="param" place="param_eps1"/>
      <connect-out port="param" place="param_eps2"/>
      <connect-out port="div" place="eps1"/>
    </transition>
    <transition name="eps2">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              -10
            </property>
            <property key="x">
              1410
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <in name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -30
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <out name="div" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  20
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <expression>
          ${div} := ${param}; ${div.S} := ${div.S} * (1.0 + 2.0 * ${div.epsilon})
        </expression>
      </defun>
      <connect-in port="param" place="param_eps2"/>
      <connect-out port="param" place="param_delta"/>
      <connect-out port="div" place="eps2"/>
    </transition>
    <transition name="delta">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              -70
            </property>
            <property key="x">
              1970
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <in name="param" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  10
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="div" type="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  10
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <expression>
          ${div} := ${param}; ${div.sigma} := ${div.sigma} * (1.0 + ${div.delta})
        </expression>
      </defun>
      <connect-in port="param" place="param_delta"/>
      <connect-out port="div" place="delta"/>
    </transition>
    <transition name="asian_id" inline="true">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              500
            </property>
            <property key="x">
              950
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <struct name="state">
          <field name="its" type="long"/>
          <field name="param" type="param"/>
        </struct>
        <struct name="wait">
          <field name="wait" type="long"/>
        </struct>
        <in name="param" type="param" place="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -10
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="sums" type="sums" place="sums">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  10
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <net>
          <place name="param" type="param"/>
          <place name="sums" type="sums"/>
          <place name="state" type="state"/>
          <place name="wait" type="wait"/>
          <place name="accu" type="sums"/>
          <place name="param_to_run" type="param"/>
          <place name="sums_part" type="sums"/>
          <transition name="init">
            <defun>
              <in name="param" type="param"/>
              <out name="state" type="state"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${state.param} := ${param}; ${state.its} := 0; ${wait.wait} := (${param.iterations_per_run} + ${param.n} - 1) div ${param.iterations_per_run}; ${accu.sum1} := 0.0; ${accu.sum2} := 0.0; ${accu.param} := ${param}
              </expression>
            </defun>
            <connect-in port="param" place="param"/>
            <connect-out port="state" place="state"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
          </transition>
          <transition name="generate">
            <defun>
              <in name="state" type="state"/>
              <out name="state" type="state"/>
              <out name="param" type="param"/>
              <expression>
                ${param} := ${state.param}; ${state.its} := ${state.its} + ${state.param.iterations_per_run}
              </expression>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-out port="state" place="state"/>
            <connect-out port="param" place="param_to_run"/>
            <condition>
              ${state.its} :lt: ${state.param.n}
            </condition>
          </transition>
          <transition name="run">
          <defun name="asian">
            <in name="param" type="param"/>
            <out name="sums" type="sums"/>
            <module name="asian" function="sums run (param)">
              <cinclude href="run_impl.hpp"/>
              <ld flag="-lprocess"/>
              <code>
                <![CDATA[
          return ::asian::run (param);
        ]]>
              </code>
            </module>
          </defun>
            <connect-in port="param" place="param_to_run"/>
            <connect-out port="sums" place="sums_part"/>
          </transition>
          <transition name="accum">
            <defun>
              <in name="wait" type="wait"/>
              <in name="sums" type="sums"/>
              <in name="accu" type="sums"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${wait.wait} := ${wait.wait} - 1; ${accu.sum1} := ${accu.sum1} + ${sums.sum1}; ${accu.sum2} := ${accu.sum2} + ${sums.sum2}
              </expression>
            </defun>
            <connect-in port="accu" place="accu"/>
            <connect-in port="sums" place="sums_part"/>
            <connect-in port="wait" place="wait"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
            <condition>
              ${wait.wait} :gt: 0
            </condition>
          </transition>
          <transition name="done">
            <defun>
              <in name="state" type="state"/>
              <in name="accu" type="sums"/>
              <in name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression/>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-in port="wait" place="wait"/>
            <connect-in port="accu" place="accu"/>
            <connect-out port="accu" place="sums"/>
            <condition>
              ${wait.wait} :le: 0
            </condition>
          </transition>
        </net>
      </defun>
      <connect-in port="param" place="id"/>
      <connect-out port="sums" place="sums_id"/>
    </transition>
    <transition name="asian_eps1" inline="true">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              350
            </property>
            <property key="x">
              1450
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <struct name="state">
          <field name="its" type="long"/>
          <field name="param" type="param"/>
        </struct>
        <struct name="wait">
          <field name="wait" type="long"/>
        </struct>
        <in name="param" type="param" place="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -10
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="sums" type="sums" place="sums">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <net>
          <place name="param" type="param"/>
          <place name="sums" type="sums"/>
          <place name="state" type="state"/>
          <place name="wait" type="wait"/>
          <place name="accu" type="sums"/>
          <place name="param_to_run" type="param"/>
          <place name="sums_part" type="sums"/>
          <transition name="init">
            <defun>
              <in name="param" type="param"/>
              <out name="state" type="state"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${state.param} := ${param}; ${state.its} := 0; ${wait.wait} := (${param.iterations_per_run} + ${param.n} - 1) div ${param.iterations_per_run}; ${accu.sum1} := 0.0; ${accu.sum2} := 0.0; ${accu.param} := ${param}
              </expression>
            </defun>
            <connect-in port="param" place="param"/>
            <connect-out port="state" place="state"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
          </transition>
          <transition name="generate">
            <defun>
              <in name="state" type="state"/>
              <out name="state" type="state"/>
              <out name="param" type="param"/>
              <expression>
                ${param} := ${state.param}; ${state.its} := ${state.its} + ${state.param.iterations_per_run}
              </expression>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-out port="state" place="state"/>
            <connect-out port="param" place="param_to_run"/>
            <condition>
              ${state.its} :lt: ${state.param.n}
            </condition>
          </transition>
          <transition name="run">
          <defun name="asian">
            <in name="param" type="param"/>
            <out name="sums" type="sums"/>
            <module name="asian" function="sums run (param)">
              <cinclude href="run_impl.hpp"/>
              <ld flag="-lprocess"/>
              <code>
                <![CDATA[
          return ::asian::run (param);
        ]]>
              </code>
            </module>
          </defun>
            <connect-in port="param" place="param_to_run"/>
            <connect-out port="sums" place="sums_part"/>
          </transition>
          <transition name="accum">
            <defun>
              <in name="wait" type="wait"/>
              <in name="sums" type="sums"/>
              <in name="accu" type="sums"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${wait.wait} := ${wait.wait} - 1; ${accu.sum1} := ${accu.sum1} + ${sums.sum1}; ${accu.sum2} := ${accu.sum2} + ${sums.sum2}
              </expression>
            </defun>
            <connect-in port="accu" place="accu"/>
            <connect-in port="sums" place="sums_part"/>
            <connect-in port="wait" place="wait"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
            <condition>
              ${wait.wait} :gt: 0
            </condition>
          </transition>
          <transition name="done">
            <defun>
              <in name="state" type="state"/>
              <in name="accu" type="sums"/>
              <in name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression/>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-in port="wait" place="wait"/>
            <connect-in port="accu" place="accu"/>
            <connect-out port="accu" place="sums"/>
            <condition>
              ${wait.wait} :le: 0
            </condition>
          </transition>
        </net>
      </defun>
      <connect-in port="param" place="eps1"/>
      <connect-out port="sums" place="sums_eps1"/>
    </transition>
    <transition name="asian_eps2" inline="true">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              170
            </property>
            <property key="x">
              1930
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <struct name="state">
          <field name="its" type="long"/>
          <field name="param" type="param"/>
        </struct>
        <struct name="wait">
          <field name="wait" type="long"/>
        </struct>
        <in name="param" type="param" place="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -10
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="sums" type="sums" place="sums">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  10
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <net>
          <place name="param" type="param"/>
          <place name="sums" type="sums"/>
          <place name="state" type="state"/>
          <place name="wait" type="wait"/>
          <place name="accu" type="sums"/>
          <place name="param_to_run" type="param"/>
          <place name="sums_part" type="sums"/>
          <transition name="init">
            <defun>
              <in name="param" type="param"/>
              <out name="state" type="state"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${state.param} := ${param}; ${state.its} := 0; ${wait.wait} := (${param.iterations_per_run} + ${param.n} - 1) div ${param.iterations_per_run}; ${accu.sum1} := 0.0; ${accu.sum2} := 0.0; ${accu.param} := ${param}
              </expression>
            </defun>
            <connect-in port="param" place="param"/>
            <connect-out port="state" place="state"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
          </transition>
          <transition name="generate">
            <defun>
              <in name="state" type="state"/>
              <out name="state" type="state"/>
              <out name="param" type="param"/>
              <expression>
                ${param} := ${state.param}; ${state.its} := ${state.its} + ${state.param.iterations_per_run}
              </expression>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-out port="state" place="state"/>
            <connect-out port="param" place="param_to_run"/>
            <condition>
              ${state.its} :lt: ${state.param.n}
            </condition>
          </transition>
          <transition name="run">
          <defun name="asian">
            <in name="param" type="param"/>
            <out name="sums" type="sums"/>
            <module name="asian" function="sums run (param)">
              <cinclude href="run_impl.hpp"/>
              <ld flag="-lprocess"/>
              <code>
                <![CDATA[
          return ::asian::run (param);
        ]]>
              </code>
            </module>
          </defun>
            <connect-in port="param" place="param_to_run"/>
            <connect-out port="sums" place="sums_part"/>
          </transition>
          <transition name="accum">
            <defun>
              <in name="wait" type="wait"/>
              <in name="sums" type="sums"/>
              <in name="accu" type="sums"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${wait.wait} := ${wait.wait} - 1; ${accu.sum1} := ${accu.sum1} + ${sums.sum1}; ${accu.sum2} := ${accu.sum2} + ${sums.sum2}
              </expression>
            </defun>
            <connect-in port="accu" place="accu"/>
            <connect-in port="sums" place="sums_part"/>
            <connect-in port="wait" place="wait"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
            <condition>
              ${wait.wait} :gt: 0
            </condition>
          </transition>
          <transition name="done">
            <defun>
              <in name="state" type="state"/>
              <in name="accu" type="sums"/>
              <in name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression/>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-in port="wait" place="wait"/>
            <connect-in port="accu" place="accu"/>
            <connect-out port="accu" place="sums"/>
            <condition>
              ${wait.wait} :le: 0
            </condition>
          </transition>
        </net>
      </defun>
      <connect-in port="param" place="eps2"/>
      <connect-out port="sums" place="sums_eps2"/>
    </transition>
    <transition name="asian_delta" inline="true">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              -70
            </property>
            <property key="x">
              2540
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <struct name="state">
          <field name="its" type="long"/>
          <field name="param" type="param"/>
        </struct>
        <struct name="wait">
          <field name="wait" type="long"/>
        </struct>
        <in name="param" type="param" place="param">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -10
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="sums" type="sums" place="sums">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <net>
          <place name="param" type="param"/>
          <place name="sums" type="sums"/>
          <place name="state" type="state"/>
          <place name="wait" type="wait"/>
          <place name="accu" type="sums"/>
          <place name="param_to_run" type="param"/>
          <place name="sums_part" type="sums"/>
          <transition name="init">
            <defun>
              <in name="param" type="param"/>
              <out name="state" type="state"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${state.param} := ${param}; ${state.its} := 0; ${wait.wait} := (${param.iterations_per_run} + ${param.n} - 1) div ${param.iterations_per_run}; ${accu.sum1} := 0.0; ${accu.sum2} := 0.0; ${accu.param} := ${param}
              </expression>
            </defun>
            <connect-in port="param" place="param"/>
            <connect-out port="state" place="state"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
          </transition>
          <transition name="generate">
            <defun>
              <in name="state" type="state"/>
              <out name="state" type="state"/>
              <out name="param" type="param"/>
              <expression>
                ${param} := ${state.param}; ${state.its} := ${state.its} + ${state.param.iterations_per_run}
              </expression>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-out port="state" place="state"/>
            <connect-out port="param" place="param_to_run"/>
            <condition>
              ${state.its} :lt: ${state.param.n}
            </condition>
          </transition>
          <transition name="run">
          <defun name="asian">
            <in name="param" type="param"/>
            <out name="sums" type="sums"/>
            <module name="asian" function="sums run (param)">
              <cinclude href="run_impl.hpp"/>
              <ld flag="-lprocess"/>
              <code>
                <![CDATA[
          return ::asian::run (param);
        ]]>
              </code>
            </module>
          </defun>
            <connect-in port="param" place="param_to_run"/>
            <connect-out port="sums" place="sums_part"/>
          </transition>
          <transition name="accum">
            <defun>
              <in name="wait" type="wait"/>
              <in name="sums" type="sums"/>
              <in name="accu" type="sums"/>
              <out name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression>
                ${wait.wait} := ${wait.wait} - 1; ${accu.sum1} := ${accu.sum1} + ${sums.sum1}; ${accu.sum2} := ${accu.sum2} + ${sums.sum2}
              </expression>
            </defun>
            <connect-in port="accu" place="accu"/>
            <connect-in port="sums" place="sums_part"/>
            <connect-in port="wait" place="wait"/>
            <connect-out port="wait" place="wait"/>
            <connect-out port="accu" place="accu"/>
            <condition>
              ${wait.wait} :gt: 0
            </condition>
          </transition>
          <transition name="done">
            <defun>
              <in name="state" type="state"/>
              <in name="accu" type="sums"/>
              <in name="wait" type="wait"/>
              <out name="accu" type="sums"/>
              <expression/>
            </defun>
            <connect-in port="state" place="state"/>
            <connect-in port="wait" place="wait"/>
            <connect-in port="accu" place="accu"/>
            <connect-out port="accu" place="sums"/>
            <condition>
              ${wait.wait} :le: 0
            </condition>
          </transition>
        </net>
      </defun>
      <connect-in port="param" place="delta"/>
      <connect-out port="sums" place="sums_delta"/>
    </transition>
    <transition name="collect">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              280
            </property>
            <property key="x">
              2880
            </property>
          </properties>
        </properties>
      </properties>
    <defun name="collect">
      <in name="sums_id" type="sums">
        <properties name="fhg">
          <properties name="pnete">
            <properties name="position">
              <property key="y">
                50
              </property>
              <property key="x">
                40
              </property>
            </properties>
            <property key="orientation">
              SOUTH
            </property>
          </properties>
        </properties>
      </in>
      <in name="sums_eps1" type="sums">
        <properties name="fhg">
          <properties name="pnete">
            <properties name="position">
              <property key="y">
                10
              </property>
              <property key="x">
                -80
              </property>
            </properties>
            <property key="orientation">
              WEST
            </property>
          </properties>
        </properties>
      </in>
      <in name="sums_eps2" type="sums">
        <properties name="fhg">
          <properties name="pnete">
            <properties name="position">
              <property key="y">
                -30
              </property>
              <property key="x">
                -80
              </property>
            </properties>
            <property key="orientation">
              WEST
            </property>
          </properties>
        </properties>
      </in>
      <in name="sums_delta" type="sums">
        <properties name="fhg">
          <properties name="pnete">
            <properties name="position">
              <property key="y">
                -50
              </property>
              <property key="x">
                40
              </property>
            </properties>
            <property key="orientation">
              NORTH
            </property>
          </properties>
        </properties>
      </in>
      <out name="result" type="result">
        <properties name="fhg">
          <properties name="pnete">
            <properties name="position">
              <property key="y">
                -0
              </property>
              <property key="x">
                90
              </property>
            </properties>
            <property key="orientation">
              EAST
            </property>
          </properties>
        </properties>
      </out>
      <expression>
        ${r} := ${sums_id.param.r}; ${T} := ${sums_id.param.T}; ${runs} := (${sums_id.param.n} + ${sums_id.param.iterations_per_run} - 1L) div ${sums_id.param.iterations_per_run}; ${n} := double(${runs} * ${sums_id.param.iterations_per_run}); ${epsilon} := ${sums_id.param.epsilon}; ${delta} := ${sums_id.param.delta}; ${fak} := e ** (-${r} * ${T}); ${pv_id} := ${fak} * ${sums_id.sum1} / ${n}; ${pv_eps1} := ${fak} * ${sums_eps1.sum1} / ${n}; ${pv_eps2} := ${fak} * ${sums_eps2.sum1} / ${n}; ${pv_delta} := ${fak} * ${sums_delta.sum1} / ${n}; ${variance} := (${sums_id.sum2} - ${sums_id.sum1} * ${sums_id.sum1} / ${n}) / ${n} / ${n}; ${result.pv} := ${pv_id}; ${result.stddev} := ${fak} * sqrt (${variance}); ${result.Delta} := (${pv_eps1} - ${pv_id}) / ${epsilon}; ${result.Gamma} := (${pv_eps2} - 2.0 * ${pv_eps1} + ${pv_id}) / (${epsilon} * ${epsilon}); ${result.Vega} := (${pv_delta} - ${pv_id}) / ${delta}; ${result.rowID} := ${sums_id.param.rowID}
      </expression>
    </defun>
      <connect-in port="sums_id" place="sums_id"/>
      <connect-in port="sums_eps1" place="sums_eps1"/>
      <connect-in port="sums_eps2" place="sums_eps2"/>
      <connect-in port="sums_delta" place="sums_delta"/>
      <connect-out port="result" place="pre_result"/>
    </transition>
    <transition name="done">
      <properties name="fhg">
        <properties name="pnete">
          <properties name="position">
            <property key="y">
              280
            </property>
            <property key="x">
              3350
            </property>
          </properties>
        </properties>
      </properties>
      <defun>
        <in name="result" type="result">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  -80
                </property>
              </properties>
              <property key="orientation">
                WEST
              </property>
            </properties>
          </properties>
        </in>
        <out name="result" type="result">
          <properties name="fhg">
            <properties name="pnete">
              <properties name="position">
                <property key="y">
                  -0
                </property>
                <property key="x">
                  90
                </property>
              </properties>
              <property key="orientation">
                EAST
              </property>
            </properties>
          </properties>
        </out>
        <module name="asian" function="done (result)">
          <cinclude href="fhglog/fhglog.hpp"/>
          <code>
            <![CDATA[
            LOG(INFO, "done row with result " << result);
          ]]>
          </code>
        </module>
      </defun>
      <connect-in port="result" place="pre_result"/>
      <connect-out port="result" place="result"/>
    </transition>
  </net>
</defun>
