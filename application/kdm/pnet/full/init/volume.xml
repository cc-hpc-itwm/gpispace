<defun>
  <in name="config" type="config" place="config"/>
  <in name="volume_with_store" type="volume_with_store" place="volume_with_store"/>
  <out name="volume_in_progress" type="volume_in_progress" place="volume_in_progress"/>

  <net>

    <place name="config" type="config"/>
    <place name="volume_with_store" type="volume_with_store"/>
    <place name="volume_in_progress" type="volume_in_progress"/>

    <transition name="initialize_volume">
      <require key="GPI" />
      <require key="init" />
      <defun>
        <in name="config" type="config"/>
        <in name="volume" type="volume_with_store"/>
        <out name="volume" type="volume_with_store"/>
        <module name="kdmfull" function="initialize_volume (config, volume)"/>
      </defun>
      <connect-read port="config" place="config"/>
      <connect-in port="volume" place="volume_with_store"/>
      <connect-out port="volume" place="volume_initialized"/>
    </transition>

    <place name="volume_initialized" type="volume_with_store"/>

    <transition name="start_volume">
      <defun>
        <in name="volume" type="volume_with_store"/>
        <out name="started" type="volume_in_progress"/>
        <expression>
          ${started.volume} := ${volume};

          ${started.assigned.bunch.id} := -1L;
          ${started.assigned.store.id} := -1L;
        </expression>
      </defun>
      <connect-in port="volume" place="volume_initialized"/>
      <connect-out port="started" place="volume_in_progress"/>
    </transition>
  </net>
</defun>
