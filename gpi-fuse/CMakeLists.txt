find_package (PkgConfig QUIET)
pkg_check_modules (PC_FUSE fuse QUIET)

find_path ( FUSE_INCLUDE_DIR fuse/fuse.h
            HINTS ${PC_FUSE_INCLUDE_DIRS} ${PC_FUSE_INCLUDEDIR}
            PATH_SUFFIXES fuse
          )

foreach (lib ${PC_FUSE_LIBRARIES})
  find_library ( FUSE_LIBRARY_${lib} NAMES ${lib}
                 HINTS ${PC_FUSE_LIBDIR} ${PC_FUSE_LIBRARY_DIRS}
	       )
  set (FUSE_LIBRARIES ${FUSE_LIBRARIES} ${FUSE_LIBRARY_${lib}})
endforeach()

if (NOT FUSE_INCLUDE_DIR)
  message (FATAL_ERROR "FUSE NOT FOUND!")
endif (NOT FUSE_INCLUDE_DIR)
include_directories (SYSTEM ${FUSE_INCLUDE_DIR})

include_directories (${GPI_SPACE_INCLUDE_DIR})

include_directories (${FhgLog_INCLUDE_DIR})

include_directories (${UTIL_INCLUDE_DIR})

include_directories (${CMAKE_CURRENT_SOURCE_DIR}/src)

add_library (gpi-fuse src/gpifs/comm.cpp)

add_executable (gpifs src/gpifs/gpifs.cpp)

target_link_libraries (gpifs gpi-fuse)
target_link_libraries (gpifs ${FUSE_LIBRARIES})
target_link_libraries (gpifs
  gpi-space-pc-client-static
  gpi-space-pc-segment
  gpi-space-static
  )
target_link_libraries (gpifs ${FhgLog_LIBRARY})
target_link_libraries (gpifs ${Boost_THREAD_LIBRARY})
target_link_libraries (gpifs ${Boost_SERIALIZATION_LIBRARY})
target_link_libraries (gpifs ${Boost_FILESYSTEM_LIBRARY})
target_link_libraries (gpifs ${Boost_SYSTEM_LIBRARY})
set_target_properties (gpifs PROPERTIES COMPILE_FLAGS "${PC_FUSE_CFLAGS_OTHER}")

install (TARGETS gpifs
  RUNTIME
  DESTINATION bin
  COMPONENT runtime
)

fhg_add_test (test/test_split.cpp
  PROJECT gpi-fuse
  LINK_LIBRARIES gpi-fuse
                 ${FUSE_LIBRARIES}
                 gpi-space-pc-client-static
                 gpi-space-pc-segment
                 gpi-space-static
                 ${FhgLog_LIBRARY}
                 ${Boost_THREAD_LIBRARY}
                 ${Boost_SERIALIZATION_LIBRARY}
                 ${Boost_FILESYSTEM_LIBRARY}
                 ${Boost_SYSTEM_LIBRARY}
  COMPILE_FLAGS "${PC_FUSE_CFLAGS_OTHER}"
)

add_executable (seek test/seek.c)
set_target_properties (seek PROPERTIES COMPILE_FLAGS -std=c99)
