<defun>
  <in name="assigned_package" type="assigned_package" place="assigned_package"/>
  <out name="assigned_package" type="assigned_package" place="loaded_package"/>
  <out name="trigger" type="control" place="trigger"/>
  <tunnel name="config" type="config" place="config"/>

  <net>

    <place name="config" type="config" virtual="true"/>
    <place name="assigned_package" type="assigned_package"/>
    <place name="loaded_package" type="assigned_package"/>
    <place name="trigger" type="control"/>

    <transition name="load">
      <defun>
        <in name="config" type="config"/>
        <in name="assigned_package" type="assigned_package"/>
        <out name="assigned_package" type="assigned_package"/>
        <module name="ufbmig_calc" function="load (config, assigned_package)">
          <cinclude href="fhglog/fhglog.hpp"/>
          <code><![CDATA[
            LOG (INFO, "LOAD " << assigned_package);
          ]]></code>
        </module>
      </defun>
      <connect-read port="config" place="config"/>
      <connect-in port="assigned_package" place="assigned_package"/>
      <connect-out port="assigned_package" place="pre_loaded_package"/>
    </transition>

    <place name="pre_loaded_package" type="assigned_package"/>

    <include-template href="lib/trigger_when.xml"/>
    <specialize name="trigger_when_assigned_package" use="trigger_when">
      <type-map replace="T" with="assigned_package"/>
    </specialize>

    <transition name="trigger">
      <use name="trigger_when_assigned_package"/>
      <connect-in port="object" place="pre_loaded_package"/>
      <connect-out port="object" place="loaded_package"/>
      <connect-out port="trigger" place="trigger"/>
    </transition>

  </net>

</defun>
