<defun name="test_use">
  <in name="in" type="control" place="in"/>
  <out name="out" type="control" place="out"/>

  <net>

    <place name="in" type="control"/>
    <place name="out" type="control"/>

    <defun name="fun">
      <in name="i1" type="long"/>
      <in name="i2" type="double"/>
      <in name="trigger" type="control"/>
      <out name="trigger" type="control"/>
      <out name="sz" type="string"/>
      <out name="oeh" type="bitset"/>
      <expression>
        ${oeh} := bitset_insert ({}, ${i1});
      </expression>
    </defun>

    <defun name="f">
      <in name="i" type="int"/>
      <out name="i" type="int"/>
      <expression/>
    </defun>

    <transition name="t0">
      <use name="fun"/>
      <connect-in port="trigger" place="in"/>
      <connect-out port="trigger" place="done_t0"/>
    </transition>

    <place name="done_t0" type="control"/>

    <transition name="t1">
      <defun>
        <in name="trigger" type="control" place="in"/>
        <out name="trigger" type="control" place="out"/>
        <net>
          <defun name="f">
            <in name="s" type="string"/>
            <out name="s" type="string"/>
            <expression/>
          </defun>

          <place name="s" type="string"/>

          <transition name="use_f">
            <use name="f"/>
            <connect-in port="s" place="s"/>
            <connect-out port="s" place="s"/>
          </transition>

          <place name="in" type="control"/>
          <place name="out" type="control"/>
          <transition name="trans">
            <use name="fun"/>
            <connect-in port="trigger" place="in"/>
            <connect-out port="trigger" place="out"/>
          </transition>
        </net>
      </defun>
      <connect-in port="trigger" place="done_t0"/>
      <connect-out port="trigger" place="out"/>
    </transition>
  </net>
</defun>
